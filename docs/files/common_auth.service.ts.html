<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>common/auth.service.ts</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/AddCarButtonComponent.html">AddCarButtonComponent</a></li>
                                <li><a href="../classes/AddCarComponent.html">AddCarComponent</a></li>
                                <li><a href="../classes/AddFillUpComponent.html">AddFillUpComponent</a></li>
                                <li><a href="../classes/AddReminderComponent.html">AddReminderComponent</a></li>
                                <li><a href="../classes/AppComponent.html">AppComponent</a></li>
                                <li><a href="../classes/AuthService.html">AuthService</a></li>
                                <li><a href="../classes/CarComponent.html">CarComponent</a></li>
                                <li><a href="../classes/CarDetailViewComponent.html">CarDetailViewComponent</a></li>
                                <li><a href="../classes/CarsComponent.html">CarsComponent</a></li>
                                <li><a href="../classes/CarsDataResolve.html">CarsDataResolve</a></li>
                                <li><a href="../classes/CarsListComponent.html">CarsListComponent</a></li>
                                <li><a href="../classes/ChromeComponent.html">ChromeComponent</a></li>
                                <li><a href="../classes/CompleteRegistrationComponent.html">CompleteRegistrationComponent</a></li>
                                <li><a href="../classes/DataService.html">DataService</a></li>
                                <li><a href="../classes/DropDownMenuComponent.html">DropDownMenuComponent</a></li>
                                <li><a href="../classes/EditCarComponent.html">EditCarComponent</a></li>
                                <li><a href="../classes/EditFillUpComponent.html">EditFillUpComponent</a></li>
                                <li><a href="../classes/EditReminderComponent.html">EditReminderComponent</a></li>
                                <li><a href="../classes/FillUpDetailComponent.html">FillUpDetailComponent</a></li>
                                <li><a href="../classes/FillUpsComponent.html">FillUpsComponent</a></li>
                                <li><a href="../classes/FillUpsDataResolve.html">FillUpsDataResolve</a></li>
                                <li><a href="../classes/FillUpsListComponent.html">FillUpsListComponent</a></li>
                                <li><a href="../classes/FillUpsListEntryComponent.html">FillUpsListEntryComponent</a></li>
                                <li><a href="../classes/NotificationHubService.html">NotificationHubService</a></li>
                                <li><a href="../classes/ProfileComponent.html">ProfileComponent</a></li>
                                <li><a href="../classes/RemindersComponent.html">RemindersComponent</a></li>
                                <li><a href="../classes/RemindersListComponent.html">RemindersListComponent</a></li>
                                <li><a href="../classes/RemindersListEntryComponent.html">RemindersListEntryComponent</a></li>
                                <li><a href="../classes/SignInComponent.html">SignInComponent</a></li>
                                <li><a href="../classes/SignUpComponent.html">SignUpComponent</a></li>
                                <li><a href="../classes/StatusBarComponent.html">StatusBarComponent</a></li>
                                <li><a href="../classes/SummaryComponent.html">SummaryComponent</a></li>
                                <li><a href="../classes/UtilitiesService.html">UtilitiesService</a></li>
                                <li><a href="../classes/WellcomeComponent.html">WellcomeComponent</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/AddCarModule.html">AddCarModule</a></li>
                                <li><a href="../modules/AppModule.html">AppModule</a></li>
                                <li><a href="../modules/AuthModule.html">AuthModule</a></li>
                                <li><a href="../modules/CarDetailModule.html">CarDetailModule</a></li>
                                <li><a href="../modules/DashboardModule.html">DashboardModule</a></li>
                                <li><a href="../modules/RoutingModule.html">RoutingModule</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: common/auth.service.ts</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import { Injectable } from &#x27;@angular/core&#x27;;
import { Headers, Http } from &#x27;@angular/http&#x27;;

import { Observable } from &#x27;rxjs&#x27;;
import &#x27;rxjs/add/operator/toPromise&#x27;;
import &#x27;rxjs/add/operator/map&#x27;;

import { DataService } from &#x27;./data.service&#x27;;

/**
 * Performs actual authentication operations used by auth module and elsewhere
 *
 * @class AuthService
 */
@Injectable()
export class AuthService {
	private headers = new Headers({&#x27;Content-Type&#x27;: &#x27;application/json&#x27;});
	private authUrl = &#x27;http://localhost:3000/api/&#x27;;
	public loggedIn: boolean = false;

  constructor(private http: Http, private dataService: DataService) { }

  /**
   * Tries to log in a user
   *
   * @method logIn
   * @param username
   * @return {Promise&lt;boolean&gt;} Will resolve to true if log in succeeded
   */
  logIn(username: string): Promise&lt;boolean&gt; {
		return this.http
			.post(this.authUrl + &#x27;login&#x27;, JSON.stringify({username: username}), {headers: this.headers})
      .toPromise()		// Because Angular http service returns observable
	    .then(response =&gt; {
        if (response.json().authMessage) {
	    		this.loggedIn = true;
	    		return true;
	    	}
	    	else
	    		return false;
	    })																									
			.catch(this.handleError);	// a single method deals with error in this class
  }
  /**
   * Tells whether a user is logged in
   *
   * @method isLoggedIn
   * @return {Promise&lt;boolean&gt;} Will resolve to true if user is logged in
   */
  isLoggedIn(): Promise&lt;boolean&gt; {
  	return this.http.get(this.authUrl + &#x27;loggedIn&#x27;)
  						.toPromise()
  						.then(response =&gt; {
  							if (response.json().authMessage) {
                  this.loggedIn = true;
                  return true;
                }
  							else {
                  this.loggedIn = false;
                  return false;
                } 
  						})
  						.catch(this.handleError);
  }
  /**
   * Checks whether a user name exists in the back-end database
   *
   * @method nameExists
   * @param name
   * @return {Observable&lt;boolean&gt;}
   */
  nameExists(name: string): Observable&lt;boolean&gt; {
  	return this.http
  					.post(this.authUrl + &#x27;userExists&#x27;,  JSON.stringify({username: name}), {headers: this.headers})
  					.map(response =&gt; {
  						if (response.json().authMessage) {
  							return true;
  						}
  						else return false;
  					})
  }
  /**
   * Tries to register a new user
   *
   * @method signUp
   * @param username
   * @return {Promise&lt;boolean&gt;} Will resolve to true if sign up succeeded
   */
  signUp(username: string): Promise&lt;boolean&gt; {
  	return this.http
  		.post(this.authUrl + &#x27;signUp&#x27;, JSON.stringify({username: username}), {headers: this.headers})
  		.toPromise()
  		.then(response =&gt; {
  			if (!response.json().authMessage) // if no errors
  				return !this.logIn(username);	// logIn returns true on success, where we need true on errors
  			else
  				return Promise.resolve(response.json().authMessage);
  		})
  		.then(response =&gt; {
  			return response;
  		})
  		.catch(this.handleError);
  }
  /**
   * Tries to log out a user
   *
   * @method logout
   * @return {Promise&lt;boolean&gt;} Will resolve to true if log out succeeded
   */
  logout(): Promise&lt;boolean&gt; {
    return this.http.get(this.authUrl + &#x27;logout&#x27;)
            .toPromise()
            .then(response =&gt; {
              if (response.json().authMessage === &#x27;ok&#x27;) {
                  this.loggedIn = false;
                  this.dataService.clearCache();
                  return true;
              }
               else return false;
            })
            .catch(this.handleError);
  }

	private handleError(error: any): Promise&lt;any&gt; {
    return Promise.reject(error.message || error.statusText || error);
  }
}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
